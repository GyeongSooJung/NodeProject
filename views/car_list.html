{% extends 'layout.html' %}

{% block css %}
<link href="../assets/plugins/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-autofill-bs4/css/autoFill.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-colreorder-bs4/css/colReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-keytable-bs4/css/keyTable.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-rowreorder-bs4/css/rowReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-select-bs4/css/select.bootstrap4.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<!-- begin #content -->
<div id="content" class="content">
	<!-- begin page-header -->
	<h1 class="page-header">차량 목록</h1>
	<!-- end page-header -->
	<!-- begin row -->
	<div class="row">
		<!-- begin col-12 -->
		<div class="col-xl-12">
			<div class="panel panel-inverse">
				<!-- begin panel-heading -->
				<div class="panel-heading">
					<h4 class="panel-title">자동차</h4>
				</div>
				<!-- end panel-heading -->
				<!-- begin panel-body -->
				<div class="panel-body">
					
	                <div class="mt-2 mb-2 d-flex justify-content-end align-items-center">
		            	<div class="mr-2">검색 : </div>
				<div><input type="text" id="CNkeyword" class="form-control" placeholder ="차량번호" /></div>
				<div><button class="ml-2 btn btn-primary text-white px-1" onclick="searchbutton()">{% if CN %} <i class="fas fa-lg fa-fw m-r-10 fa-chevron-left"></i> {% else %}<i class="mx-1 fas fa-lg fa-fw fa-search align-items-center"></i> {% endif %}</button></div>
					</div>
					
					<div class="overflow-auto">
						<form action="/car/car_select_delete" method="post">
							<table id="data-table-combine" class="table table-striped table-bordered table-hover table-td-valign-middle text-center">
								<thead>
									<tr>
										<th width="1%">
											<input type="checkbox" class="neHeros" value="" onChange="allCheckedBox(this);"/>
										</th>
										<th width="2.5%"></th>
										<th>차종</th>
										<th>차량 번호</th>
										<th>차대 번호</th>
										<th>등록 일자</th>
										<th>수정 일자</th>
										<th width="1%"></th>
									</tr>
								</thead>
								<tbody>
									{% if (totalNum == 0) %}
									<tr>
										<td colspan="7">No Data</td>
									</tr>
									{% else %}
									{% set count = 0 %}
										{% for car in cars %}
										<tr>
			    							<td class="with-btn" nowrap>
												<input id ="ck" type="checkbox" name = "ck" class="neHeros" value={{car.CN}} onChange="eachCheckedBox(this);"/>
			    							</td>
			    							<td class="font-weight-bold">{{totalNum - count - (currentPage*10)}} </td>
				  							{% set totalNum = totalNum - 1 %}
			    							{% if car.CC == 1 %}
												<td>경차</td>
											{% elif car.CC == 2 %}
												<td>소형</td>
											{% elif car.CC == 3 %}
												<td>중형</td>
											{% elif car.CC == 4 %}
												<td>대형</td>
											{% elif car.CC == 5 %}
												<td>SUV</td>
											{% elif car.CC == 6 %}
												<td>승합</td>
											{% elif car.CC == 7 %}
												<td>상용</td>
											{% elif car.CC == 8 %}
												<td>전기</td>
											{% elif car.CC == 6 %}
												<td>외제</td>
											{% else %}
												<td>선택안됨</td>
											{% endif %}
											<td>{{car.CN}}</td>
											{% if car.SN %}
											<td>{{car.SN}}</td>
											{% else %} <td>선택안됨 </td>
											{% endif %}
											
											<td>
												<script>
										        Timefunction("{{car.CA}}");
												</script>
											</td>
											<td>
												<script>
												Timefunction("{{car.UA}}");
												</script>
											</td>
											<td class="with-btn" nowrap>
												<a href="/car_edit/{{car.CN}}" class="btn btn-sm btn-primary width-60 m-r-2">수정</a>
												<a href="javascript:delete_check('{{car.CN}}')" class="btn btn-sm btn-white width-60">삭제</a>
											</td>
										</tr>
										{% endfor %}
									{% endif %}
								</tbody>
							</table>
							<div class="d-flex justify-content-between align-item-center">
								<input class="btn btn-primary" type='button' value='선택항목 삭제' onclick="return btn(this.form);">
								
								<div class="d-flex justify-content-around align-item-center">
									<a href="javascript:pageDoubleBtn('left')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-double-left"></i></a>
									<a href="javascript:pageBtn('left')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-left"></i></a>
									{% if (totalNum==0) %}
									{% else %}
										{% for i in range(startPage, endPage) %}
										<a href="/car_list/?page={{i}}" class="btn btn-white mr-1 px-2 text-primary" style="{% if(currentPage==i} %} background-color: #00acac; color: white !important; {% endif %} ">{{i+1}}</a>
										{% endfor %}
									{% endif %}
									<a href="javascript:pageBtn('right')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-right"></i></a>
									<a href="javascript:pageDoubleBtn('right')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-double-right"></i></a>
								</div>
							</div>
						</form>
					</div>
				</div>
				<!-- end panel-body -->
			</div>
		</div>
		<!-- end col-10 -->
	</div>
	<!-- end row -->
</div>
<!-- end #content -->

	<!--검색기능-->
    
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>	
	<script>
	 window.onload = () => {
							if (new URL(location.href).searchParams.get('searcherror')) {
								alert('검색어를 다시 확인해주세요');
							}
	        }
	
	

		$(document).ready(function() {
	            $("#keyword").keyup(function() {
	                var k = $(this).val();
	                $("#data-table-combine > tbody > tr").hide();
	                var temp = $("#data-table-combine > tbody > tr > td:contains('" + k + "')");
	
	                $(temp).parent().show();
	            })
	        })
	
		function searchbutton() {
			const keyword = document.getElementById('CNkeyword').value;
			location = '/car_list/?CN=' + keyword;
		}
		function pageBtn(dir) {
			if(dir == 'left') {
				location = '/car_list/?page={{currentPage-1}}';
			}
			if(dir == 'right') {
				location = '/car_list/?page={{currentPage+1}}';
			}
		}
		
		function pageDoubleBtn(dir) {
			if(dir == 'left') {
				location = '/car_list/?page={{startPage-1}}';
			}
			if(dir == 'right') {
				location = '/car_list/?page={{endPage+1}}';
			}
		}
			
		function btn(frm) {
			var answer;
			answer = confirm("데이터를 삭제하시겠습니까?");
			if(answer == true){
				frm.action='/car/car_select_delete/'; frm.submit(); return true;
			}
			else {
				location = '/car_list';
			}
		}
	
	
		function delete_check(ck) {
			var answer;
			var ckc = ck;
			//페이지를 이동하기 전에 confirm()을 사용해 다시 한번 확인한다.
			//확인을 선택하면 answer에  true, 취소를 선택하면 false 값이 들어간다.
			answer = confirm("데이터를 삭제하시겠습니까?");
			//확인을 선택한 경우 자바스크립트를 호출할 때 같이 넘어온 url이라는 변수에 들어있는 주소로 페이지 이동
			if(answer == true){
				location = '/car/car_delete/' + ckc;
			}
			else {
				location = '/car_list';
			}
		}

		function allCheckedBox(obj) {
			
	   	// @brief 선택한 체크박스의 클래스 명칭을 가져온다.
	   	const termClass = obj.getAttribute("class");
	
	   	// @brief 선택한 클래스명과 같은 클래스의 갯수
	   	console.log(document.getElementsByClassName(termClass).length);
	
	   	Array.prototype.forEach.call(document.getElementsByClassName(termClass), function(element, index, array) {
	
	        // @brief 엘리먼트의 값 출력
	        console.log(element.value);
	        // @brief 선택한 클래스의 첫번째 checkbox의 상태가 체크가 되있는 경우
	        if(document.getElementsByClassName(termClass)[0].checked == true) {
	            // @brief 같은 클래스명을 가진 모든 checkbox의 상태를 선택 완료 처리 한다.
	            element.checked = true;
	        }
	        // @brief 선택한 클래스의 첫번째 checkbox의 상태가 체크가 해제된 경우
	        else {
	            // @brief 같은 클래스명을 가진 모든 checkbox의 상태를 선택 해제 처리 한다.
	            element.checked = false;
	        }
	   	});
	    }
    
    
	   function eachCheckedBox(obj) {
	      // @brief 선택한 체크박스의 상태가 선택해제인 경우
	      if(obj.checked == false) {
	            // @brief 선택한 체크박스의 클래스 명칭을 가져온다.
	            const termClass = obj.getAttribute("class");
	            // @brief 첫번째 checkbox의 상태가 체크가 되어있는경우
	            if(document.getElementsByClassName(termClass)[0].checked == true) {
	                // @brief 첫번째 checkbox의 상태를 체크해제한다.
	                document.getElementsByClassName(termClass)[0].checked = false;
	            }
	        }
	    }
	    
		window.onload = () => {
			if (new URL(location.href).searchParams.get('length')) {
				alert('차량 번호 자릿수를 확인해주세요.');
			}
			if (new URL(location.href).searchParams.get('type')) {
				alert('차량 번호를 확인해주세요.');
			}
			if (new URL(location.href).searchParams.get('error')) {
				alert('차량 번호 또는 차대 번호를 다시 확인해주세요.');
			}
		};
	</script>
{% endblock %}

{% block script %}
<script src="../assets/plugins/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-colreorder/js/dataTables.colReorder.min.js"></script>
<script src="../assets/plugins/datatables.net-colreorder-bs4/js/colReorder.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="../assets/plugins/datatables.net-keytable-bs4/js/keyTable.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-rowreorder-bs4/js/rowReorder.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.colVis.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="../assets/plugins/pdfmake/build/pdfmake.min.js"></script>
<script src="../assets/plugins/pdfmake/build/vfs_fonts.js"></script>
<script src="../assets/plugins/jszip/dist/jszip.min.js"></script>

<!--<script src="../assets/js/demo/table-manage-combine.demo.js"></script>-->
{% endblock %}