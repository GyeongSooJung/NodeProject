{% extends 'layout.html' %}

{% block css %}
<link href="../assets/plugins/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-autofill-bs4/css/autoFill.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-colreorder-bs4/css/colReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-keytable-bs4/css/keyTable.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-rowreorder-bs4/css/rowReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-select-bs4/css/select.bootstrap4.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<!-- begin #content -->
<div id="content" class="content">
	<!-- begin breadcrumb -->
	<ol class="breadcrumb float-xl-right">
		<li class="breadcrumb-item"><a href="javascript:;">Home</a></li>
		<li class="breadcrumb-item"><a href="javascript:;">Tables</a></li>
		<li class="breadcrumb-item active">Managed Tables</li>
	</ol>
	<!-- end breadcrumb -->
	<!-- begin page-header -->
	<h1 class="page-header">Disinfection History <small>소독 이력</small></h1>
	<!-- end page-header -->
	<!-- begin panel -->
	<div class="panel panel-inverse">
		<!-- begin panel-heading -->
		<div class="panel-heading">
			<h4 class="panel-title">기록</h4>
			<div class="panel-heading-btn">
				<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
				<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-redo"></i></a>
				<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
				<a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
			</div>
		</div>
		<!-- end panel-heading -->
		<!-- begin panel-body -->
		<div class="panel-body">
			         <center>
            <div class="btn-group m-b-5 mx-3">
               <a href="/history_list" class="btn btn-primary text-white px-4">전체</a>
            </div>
            <div class="btn-group m-b-5 mx-3">
               <a href="javascript:;" class="btn btn-primary text-white px-5">차량</a>
               <a href="#" data-toggle="dropdown" class="btn btn-primary dropdown-toggle text-white"><b class="caret"></b></a>
               <div class="dropdown-menu dropdown-menu-right">
                  {% for car in cars %}
                  <a href="/history_list/?CN={{car.CN}}" class="dropdown-item">{{car.CN}}</a>
                  <!--/history_CN_select/{{car.CN}}-->
                  {% endfor %}
               </div>
            </div>
            <div class="btn-group m-b-5 mx-3">
               <a href="javascript:;" class="btn btn-primary text-white px-5">장비</a>
               <a href="#" data-toggle="dropdown" class="btn btn-primary dropdown-toggle text-white"><b class="caret"></b></a>
               <div class="dropdown-menu dropdown-menu-right">
                  {% for device in devices %}
                  <a href="/history_list/?MD={{device.MD}}" class="dropdown-item">{{device.MD}}</a>
                  <!--/history_MD_select/{{device.MD}}-->
                  {% endfor %}
               </div>
            </div>
         </center>

			<form action="/history/history_select_delete" method="post">
				<table id="data-table-default" class="table table-striped table-bordered table-td-valign-middle">
					<thead>
						<tr>
							<th width="1%">
								<input type="checkbox" class="neHeros" value="" onChange="allCheckedBox(this);"/>
							</th>
							<th class="text-nowrap">Car Number</th>
						    <th class="text-nowrap">Disinfection Date</th>
							<th class="text-nowrap">Registration Date</th>
							<th class="text-nowrap">Consumed Time</th>
							<th class="text-nowrap">Result</th>
							<th width="1%"></th>
						</tr>
					</thead>
					<tbody>
						{% for history in historys %}
						<tr onClick="location.href='/history_chart/{{history._id}}'" class="odd gradeX">
	  						<td onclick='event.cancelBubble=true;' class="with-btn" nowrap>
	 							<input id="ck" type="checkbox" name = "_id" class="neHeros" value={{history._id}} onChange="eachCheckedBox(this);"/>
	  						</td>
							<td>
								{% for car in cars %}
									{% if (car._id == history.VID) %}
										{{car.CN}}
									{% endif %}
								{% endfor %}
							</td>
							<td>{{moment(history.ET).format('YYYY-MM-DD hh:mm:ss')}}</td>
							<td>{{moment(history.CA).format('YYYY-MM-DD hh:mm:ss')}}</td>
							<td>{{moment(history.ET).diff(moment(history.ST), 'minutes')+"m"}}</td>
							<td>{{history.RC}}</td>
	  						<td>
	  							<a href="javascript:delete_check('{{history._id}}')" class="btn btn-sm btn-white width-60">Delete</a>
	  						</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				<div>
					<input class="btn btn-primary" type='submit' value='선택항목 삭제' onclick="btn()">
				</div>
			</form>
		</div>
		<!-- end panel-body -->
	</div>
	<!-- end panel -->
</div>
<!-- end #content -->

	<script>
		function btn() {
			var answer;
			answer = confirm("데이터를 삭제하시겠습니까?");
			if(answer == true){
				location = '/history/history_select_delete/';
			}
			else {
				location = '/history_list';
			}
		}
	
	
		function delete_check(_id) {
			var answer;
			var idc = _id;
			//페이지를 이동하기 전에 confirm()을 사용해 다시 한번 확인한다.
			//확인을 선택하면 answer에  true, 취소를 선택하면 false 값이 들어간다.
			answer = confirm("데이터를 삭제하시겠습니까?");
			//확인을 선택한 경우 자바스크립트를 호출할 때 같이 넘어온 url이라는 변수에 들어있는 주소로 페이지 이동
			if(answer == true){
				location = '/history/history_delete/' + idc;
			}
			else {
				location = '/history_list';
			}
		}

		function allCheckedBox(obj) {
			
	   	// @brief 선택한 체크박스의 클래스 명칭을 가져온다.
	   	const termClass = obj.getAttribute("class");
	
	   	// @brief 선택한 클래스명과 같은 클래스의 갯수
	   	console.log(document.getElementsByClassName(termClass).length);
	
	   	Array.prototype.forEach.call(document.getElementsByClassName(termClass), function(element, index, array) {
	
	        // @brief 엘리먼트의 값 출력
	        console.log(element.value);
	        // @brief 선택한 클래스의 첫번째 checkbox의 상태가 체크가 되있는 경우
	        if(document.getElementsByClassName(termClass)[0].checked == true) {
	            // @brief 같은 클래스명을 가진 모든 checkbox의 상태를 선택 완료 처리 한다.
	            element.checked = true;
	        }
	        // @brief 선택한 클래스의 첫번째 checkbox의 상태가 체크가 해제된 경우
	        else {
	            // @brief 같은 클래스명을 가진 모든 checkbox의 상태를 선택 해제 처리 한다.
	            element.checked = false;
	        }
	   	});
	    }
    
    
	   function eachCheckedBox(obj) {
	      // @brief 선택한 체크박스의 상태가 선택해제인 경우
	      if(obj.checked == false) {
	            // @brief 선택한 체크박스의 클래스 명칭을 가져온다.
	            const termClass = obj.getAttribute("class");
	            // @brief 첫번째 checkbox의 상태가 체크가 되어있는경우
	            if(document.getElementsByClassName(termClass)[0].checked == true) {
	                // @brief 첫번째 checkbox의 상태를 체크해제한다.
	                document.getElementsByClassName(termClass)[0].checked = false;
	            }
	        }
	    }
 </script>


{% endblock %}

{% block script %}
<script src="../assets/plugins/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
<script src="../assets/js/demo/table-manage-default.demo.js"></script>
{% endblock %}