{% extends 'layout.html' %}

{% block css %}
<link href="../assets/plugins/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-autofill-bs4/css/autoFill.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-colreorder-bs4/css/colReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-keytable-bs4/css/keyTable.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-rowreorder-bs4/css/rowReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-select-bs4/css/select.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/switchery/switchery.min.css" rel="stylesheet" />
<link href="../assets/plugins/abpetkov-powerange/dist/powerange.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<!-- begin #content -->
<div id="content" class="content">
	<!-- begin page-header -->
	<h1 class="page-header">{{__('worker_list')}}</h1>
	<!-- end page-header -->
	<!-- begin row -->
	<div class="row">
		<!-- begin col-12 -->
		<div class="col-xl-12">
			<div class="panel panel-inverse">
				<!-- begin panel-heading -->
				<div class="panel-heading">
					<h4 class="panel-title">{{__('staff')}}</h4>
				</div>
				<!-- end panel-heading -->
				<!-- begin panel-body -->
				<div class="panel-body">
					
					<div class="mt-2 mb-2 d-flex justify-content-end align-items-center">
						<div class="mr-auto">
							<select id = "selectpage" name="data-table-default_length" aria-controls="data-table-default" class="custom-select custom-select-sm form-control form-control-sm">
								<option class ="postnumber" value="10">10</option>
								<option class ="postnumber" value="25">25</option>
								<option class ="postnumber" value="50">50</option>
								<option class ="postnumber" value="100">100</option>
							</select>
						</div>
			        	<div class="mr-2">
			            		<div class="btn-group m-r-5 m-b-5">
										<a id="searchoption" href="javascript:;" class="btn btn-default">{{__('search')}}</a>
										<a href="#" data-toggle="dropdown" class="btn btn-default dropdown-toggle" aria-expanded="false"><b class="caret"></b></a>
										<div class="dropdown-menu dropdown-menu-right" style="">
											<a href="javascript:searchoption('WN',pagingObject,i18nconvert,{WN : 'WN',PN : 'PN',EM : 'EM'});" class="dropdown-item">{{__('name')}}</a>
											<a href="javascript:searchoption('PN',pagingObject,i18nconvert,{WN : 'WN',PN : 'PN',EM : 'EM'});" class="dropdown-item">{{__('mobile_number')}}</a>
											<a href="javascript:searchoption('EM',pagingObject,i18nconvert,{WN : 'WN',PN : 'PN',EM : 'EM'});" class="dropdown-item">{{__('email')}}</a>
										
										</div>
								</div> 
						</div>
					<div>
			  				<input id ="searchtext" type="text" class="form-control" placeholder ="" />
			  			</div>
			  			<div id ="searchdatetext" class="d-none">
			  				<div class ="d-flex">
			  				<input type="date" id = "searchdatetext1" class ="form-control" placeholder ="" />
			  				&nbsp;&nbsp;~&nbsp;&nbsp;
			  				<input type="date" id = "searchdatetext2" class ="form-control" placeholder ="" />
			  				</div>
			  			</div>
			  			<div>
			  				
			  				<button id ="searchbutton" class="ml-1 btn btn-primary text-white px-1" onclick="searchtext(pagingObject, condition, i18nconvert)"><i class="mx-1 fas fa-lg fa-fw fa-search align-items-center"></i></button></div>
			  			<a href='javascript:;' id ="gotolist" onclick=gotolist(pagingObject,condition,searcherror,'{{__('search')}}') class='d-none ml-1 btn btn-primary mr-1 px-2'>{{__('all')}}</a>
		   			</div>      
					
					<div class="overflow-auto">
					    <form action="/worker/worker_update" method="post">
					        <table id="data-table-combine" class="table table-striped table-bordered table-hover table-td-valign-middle text-center">
	        					<thead>
	        						<tr>
		        							<th width="1%"><input type="checkbox" class="neHeros" value="" onChange="allCheckedBox(this);"/></th>
		        							<th width="2.5%"></th>
		        							<th width="2.5%" data-orderable="false"></th>
		        							<th width="15%" class = "sort" name = "WN">{{__('name')}}<i id = "WN" class="d-none  float-right mx-1 fas fa-lg fa-fw m-t-3 fa-angle-down"></i></th>
		        							<th width="15%" class = "sort" name = "PN">{{__('mobile_number')}}<i id = "PN" class="d-none  float-right mx-1 fas fa-lg fa-fw m-t-3 fa-angle-down"></i></th>
		        							<th width="15%" class = "sort" name = "EM">{{__('email')}}<i id = "EM" class="d-none  float-right mx-1 fas fa-lg fa-fw m-t-3 fa-angle-down"></i></th>
		        							<th width="10%">{{__('owner_auth')}}</th>
		        							<th width="10%">{{__('approval')}}</th>
		        							<th width="1%"></th>
	        						</tr>
	        					</thead>
	        					<tbody id ="memDiv">
									
	        					</tbody>
	        				</table>
							<div class="justify-content-between align-item-center">
								<center>
										<div id="pagebox" class=" justify-content-around align-item-center">
											
										</div>
								</center>
							</div>
					    </form>
				    </div>
				</div>
				<!-- end panel-body -->
			</div>
		</div>
		<!-- end col-10 -->
	</div>
	<!-- end row -->
</div>
<!-- end #content -->
	
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>	
<script>
	var pagingObject = new Object({name : "Worker" ,url : "/ajax/worker_list",CID : "{{company._id}}", array : [], sort : "CA", page : 0, postNum : 10, pageNum : 5, startpage : 0, endpage : 0, search: "", searchtext : ""});
		// 검색 기능
		
	$(document).ready(function(){
		pagereload(pagingObject, condition, i18nconvert);
		
		
		$('#selectpage').click(function() {
			selectpage(pagingObject,condition,i18nconvert,{
				option : $('#selectpage option:selected').val()
			})
		});
		
		$('#searchtext').keyup(function(key) {
				if(key.keyCode == 13) {
					searchtext(pagingObject,condition,i18nconvert)
				}
				if(pagingObject.searchtext == "") {
					pagereload(pagingObject, condition, i18nconvert);
				}
			});
		
		$('.sort').click(function() {
			$("#searchoption").empty();
			$("#searchoption").append("{{__('search')}}");
			
			sortpage(pagingObject,condition,i18nconvert,{
				name : $(this).attr('name')
			},
			{
				WN : "WN",
				PN : "PN",
				EM : "EM",
			});
		
		})
		
		$('.ck_au').change(function() {
			var post = 'POST METHOD CALL';
			var email = $(this).val();
			
			if($(this).is(":checked")){
				//Ajax POST Method TEST
				$.ajax({
					url: '/ajax/post',
					dataType: 'json',
					type: 'POST',
					data: {au_true:email},
					success: function(result) {
						if (result) {
						$('#post_output').html(result.result);
						}
					}
				});
			}
			else {
				//Ajax POST Method TEST
				$.ajax({
					url: '/ajax/post',
					dataType: 'json',
					type: 'POST',
					data: {au_false:email},
					success: function(result) {
						if (result) {
							$('#post_output').html(result.result);
						}
					}
				});
			}
		});
		
		$('.ck_ac').change(function() {
			var post = 'POST METHOD CALL';
			var email = $(this).val();
			
			if($(this).is(":checked")){
				//Ajax POST Method TEST
				$.ajax({
					url: '/ajax/post',
					dataType: 'json',
					type: 'POST',
					data: {ac_true:email},
					success: function(result) {
						if (result) {
						$('#post_output').html(result.result);
						}
					}
				});
			}
			else {
			//Ajax POST Method TEST
				$.ajax({
					url: '/ajax/post',
					dataType: 'json',
					type: 'POST',
					data: {ac_false:email},
					success: function(result) {
						if (result) {
							$('#post_output').html(result.result);
						}
					}
				});
			}
		});
	})
	        
	        
	        
	    
	function checkau(a) {
		if(a.checked){
		//Ajax POST Method TEST
			$.ajax({
				url: '/ajax/post',
				dataType: 'json',
				type: 'POST',
				data: {au_true:a.value},
				success: function(result) {
					if (result) {
						$('#post_output').html(result.result);
					}
				}
			});
		}
		else {
		//Ajax POST Method TEST
			$.ajax({
				url: '/ajax/post',
				dataType: 'json',
				type: 'POST',
				data: {au_false:a.value},
				success: function(result) {
					if (result) {
						$('#post_output').html(result.result);
					}
				}
			});
		}
	}
	
	function checkac(a) {
		if(a.checked){
			//Ajax POST Method TEST
			$.ajax({
				url: '/ajax/post',
				dataType: 'json',
				type: 'POST',
				data: {ac_true:a.value},
				success: function(result) {
					if (result) {
						$('#post_output').html(result.result);
					}
				}
			});
		}
		else {
			//Ajax POST Method TEST
			$.ajax({
			url: '/ajax/post',
			dataType: 'json',
			type: 'POST',
			data: {ac_false:a.value},
				success: function(result) {
					if (result) {
						$('#post_output').html(result.result);
					}
				}
			});
		}
	}
	var condition = function (Object) {
		var num =  Object.array.length; 	
        var	insertTr = ""; // 채워넣을 HTML 초기화
     	var indexcount = 1; // 인덱스번호 초기화
			   	
		for (var i = (Object.postNum * Object.page) ; i < (Object.postNum * Object.page) + Object.postNum ; i ++) { // 현재 페이지의 번호에 맞는 리스트 뽑아서 출력 (0 ~ 9, 10 ~ 19)
			if(Object.array.length != 0) {
				if(Object.array[i]) {
					insertTr += "<tr>";
					insertTr += " 	<td class='with-btn' nowrap>";
					insertTr += "		<input id='ck' type='checkbox' name ='ck' class='neHeros' value="+ Object.array[i].EM +" onChange='eachCheckedBox(this);'/>";
					insertTr += " 	</td>";
					insertTr += "<td class='font-weight-bold'>"+(num - (Object.page*10)) +" </td>";
					insertTr += "<td class='with-img'><img src='"+ Object.array[i].PU +"' class='img-rounded height-30' /></td>";
					insertTr += "<td>"+ Object.array[i].WN+"</td>";
					insertTr += "<td>"+ Object.array[i].PN+"</td>";
					insertTr += "<td>"+ Object.array[i].EM+"</td>";
					insertTr += "<td class='with-btn' nowrap>";
					insertTr += "<input onclick ='checkau(this)' class ='ck_au' type='checkbox'  value ='"+Object.array[i].EM+"'";
					if(Object.array[i].AU ==1)
						insertTr += "checked/>";
					else
						insertTr += "unchecked/>";
					insertTr += "</td>";
					insertTr += "<td class='with-btn' nowrap>";
					insertTr += "<input onclick ='checkac(this)' class ='ck_ac' type='checkbox'  value ='"+Object.array[i].EM+"'";
					if(Object.array[i].AC ==1)
						insertTr += "checked/>";
					else
						insertTr += "unchecked/>";
					insertTr += "</td>";
					insertTr += "<td>";
					insertTr += "<input type='button' value='{{__('delete')}}' onclick=delete_one(this) class='btn btn-sm btn-white width-60' name ='"+ Object.array[i].EM +"'></td> ";
					insertTr += "</td>";
					insertTr += "</tr>";
					num -= indexcount;
					}
				}
				else {
				insertTr += "<tr>";
				insertTr += "	<td colspan='10'>No Data</td>";
				insertTr += "</tr>";
				
				break;
			}
		}
				     	
		$("#memDiv").append(insertTr);
	}

	    
	    // 에러 링크 기능
		window.onload = () => {
			if (new URL(location.href).searchParams.get('null')) {
				alert("{{__('choice_error')}}");
			}
		}
</script>
{% endblock %}


{% block script %}

<script src="../assets/plugins/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-colreorder/js/dataTables.colReorder.min.js"></script>
<script src="../assets/plugins/datatables.net-colreorder-bs4/js/colReorder.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="../assets/plugins/datatables.net-keytable-bs4/js/keyTable.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-rowreorder-bs4/js/rowReorder.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.colVis.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="../assets/plugins/pdfmake/build/pdfmake.min.js"></script>
<script src="../assets/plugins/pdfmake/build/vfs_fonts.js"></script>
<script src="../assets/plugins/jszip/dist/jszip.min.js"></script>
<!--<script src="../assets/js/demo/table-manage-combine.demo.js"></script>-->
<script src="../assets/plugins/switchery/switchery.min.js"></script>
<script src="../assets/plugins/abpetkov-powerange/dist/powerange.min.js"></script>
<script src="../assets/js/demo/form-slider-switcher.demo.js"></script>
{% endblock %}