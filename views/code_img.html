<!DOCTYPE html>
<html lang="kor">
<head>
	<meta charset="utf-8" />
	<title>{{__('main_title')}}</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	
	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
	<link href="../assets/css/default/app.min.css" rel="stylesheet" />
	<!-- ================== END BASE CSS STYLE ================== -->
	<link href="../assets/img/favicon.png" rel="icon">
	<link href="../oasiscss/oasis.css" rel="stylesheet" />
	
	<script src="https://kit.fontawesome.com/71839e8cce.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="content" class="content mx-0">
    	<!-- begin row -->
    	<div class="row">
    		<!-- begin col-6 -->
    		<div class="col-xl-12">
    			<!-- begin panel -->
    			<div class="panel panel-inverse" data-sortable-id="form-validation-1">
    				<!-- begin panel-heading -->
    				<div class="panel-heading">
    					<h4 class="panel-title text-center">{{__('qrcode_generated')}}</h4>
    				</div>
    				<!-- end panel-heading -->
    				<!-- begin panel-body -->
    				<div class="panel-body text-center">
    				    <div id="qrbox" class="mx-auto">
    				        {% if (type == 'qr') %}
    				        <img id="qrimg" src="{{cr_qrcode}}">
    				        {% else %}
    				        <img id="stimg" src="../assets/img/oasis_qr_sticker.jpg" />
    				        <img id="miniimg" class="mb-0" src="{{cr_sticker}}" />
    				        {% endif %}
    				    </div>
                        <div class="mt-3 d-flex justify-content-center align-items-center flex-wrap">
                        	<a href="#" onclick="window.print();" class="btn btn-sm btn-white mx-1 m-b-10"><i class="fa fa-print fa-fw fa-lg"></i> Print</a>
                        	<a href="#" onclick="downIMG('jpg');" class="btn btn-sm btn-white mx-1 m-b-10"><i class="fas fa-file-image fa-fw fa-lg"></i> JPG</a>
                            <a href="#" onclick="downIMG('png');" class="btn btn-sm btn-white mx-1 m-b-10"><i class="fas fa-file-image fa-fw fa-lg"></i> PNG</a>
                            <a href="#" onclick="downIMG('pdf');" class="btn btn-sm btn-white mx-1 m-b-10"><i class="fas fa-file-pdf fa-fw fa-lg"></i> PDF</a>
                        </div>
                    </div>
    				<!-- end panel-body -->
    			</div>
    			<!-- end panel -->
    		</div>
    	</div>
    	<!-- end row -->
    </div>
    
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <script type = "text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        //이미지(png)로 다운로드
        function downIMG(ext){
            if(ext == 'jpg') {
                html2canvas($("#qrbox")[0], {scrollY: -window.scrollY}).then(function(canvas){
                    var myImage = canvas.toDataURL();
                    downloadURI(myImage, "OASIS_QR_{{company.CNA}}.jpg");
                });
            }
            else if(ext == 'png') {
                html2canvas($("#qrbox")[0], {scrollY: -window.scrollY}).then(function(canvas){
                    var myImage = canvas.toDataURL();
                    downloadURI(myImage, "OASIS_QR_{{company.CNA}}.png");
                });
            }
            else if(ext == 'pdf') {
                html2canvas($("#qrbox")[0]).then(function(canvas){
                    var doc = new jsPDF('p', 'mm', 'a4'); //jspdf객체 생성
                    var myImage = canvas.toDataURL('image/png'); //캔버스를 이미지로 변환
                    // doc.addImage(myImage, 'PNG', 0, 0); //이미지를 기반으로 pdf생성
                    // doc.save('OASIS_QR_{{company.CNA}}.pdf');
                    
                    var imgWidth = 210;
                    var pageHeight = 295;
                    var imgHeight = canvas.height * imgWidth / canvas.width;
                    var heightLeft = imgHeight;
                    var position = 30;
                    doc.addImage(myImage, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    while (heightLeft >= 0) { position = heightLeft - imgHeight; doc.addPage();
                    doc.addImage(myImage, 'PNG', 0, position, imgWidth, imgHeight); heightLeft -= pageHeight; }
                    doc.save('OASIS_QR_{{company.CNA}}.pdf');
                });
            }
        }
        
        function downloadURI(uri, name){
            var link = document.createElement("a")
            link.download = name;
            link.href = uri;
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>