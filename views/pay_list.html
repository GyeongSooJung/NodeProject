{% extends 'layout.html' %}

{% block css %}
<link href="../assets/plugins/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-autofill-bs4/css/autoFill.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-colreorder-bs4/css/colReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-keytable-bs4/css/keyTable.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-rowreorder-bs4/css/rowReorder.bootstrap4.min.css" rel="stylesheet" />
<link href="../assets/plugins/datatables.net-select-bs4/css/select.bootstrap4.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<!-- begin #content -->
<div id="content" class="content">
	<!-- begin page-header -->
	<h1 class="page-header">결제 내역</h1>
	<!-- end page-header -->
	<!-- begin row -->
	<div class="row">
		<!-- begin col-12 -->
		<div class="col-xl-12">
			<div class="panel panel-inverse">
				<!-- begin panel-heading -->
				<div class="panel-heading">
					<h4 class="panel-title">결제 내역</h4>
				</div>
				<!-- end panel-heading -->
				<!-- begin panel-body -->
				<div class="panel-body" >
					
					<div class="mt-2 mb-2 d-flex justify-content-end align-items-center">
	            	<div class="mr-2">검색 : </div>
				<div>
					<input type="text" id="MIDkeywordword" class="form-control" placeholder ="주문번호" />
				</div>
				<div>
					<button class="ml-2 btn btn-primary text-white px-1" onclick="searchbutton()">{% if MID %} <i class="fas fa-lg fa-fw m-r-10 fa-chevron-left"></i> {% else %}<i class="mx-1 fas fa-lg fa-fw fa-search align-items-center"></i> {% endif %}</button></div>
				</div>
	               	
	     <!--          	    <div class="col-xl-4">-->
	     <!--          	    <button id ="CopyBTN" class="btn btn-secondary buttons-copy buttons-html5 btn-sm" tabindex="0" aria-controls="data-table-combine" type="button"><span>Copy</span></button>	-->
	     <!--          	    <button id ="CSVBTN" class="btn btn-secondary buttons-csv buttons-html5 btn-sm" tabindex="0" aria-controls="data-table-combine" type="button"><span>CSV</span></button>-->
	     <!--          	    <button id ="ExcelBTN" class="btn btn-secondary buttons-excel buttons-html5 btn-sm" tabindex="0" aria-controls="data-table-combine" type="button"><span>Excel</span></button>-->
	     <!--          	    <button id ="PDF" class="btn btn-secondary buttons-pdf buttons-html5 btn-sm" tabindex="0" aria-controls="data-table-combine" type="button"><span>PDF</span></button>-->
						<!--<button id ="Print" class="btn btn-secondary buttons-print btn-sm" tabindex="0" aria-controls="data-table-combine" type="button"><span>Print</span></button>-->
						<!--</div>-->
					
					<div class="overflow-auto">
						<!--<form action="/device/device_select_delete" method="post">-->
							<table id="data-table-combine" class="table table-striped table-bordered table-hover table-td-valign-middle text-center">
								<thead>
									<tr>
										<th width="2.5%"></th>
										<th width="30.5%">주문 번호</th>
										<th width="23%">구매 일시</th>
										<th width="23%">상품명</th>
										<th width="23%">금액</th>
										<th width="1%"></th>
									</tr>
								</thead>
								<tbody>
									{% if (totalNum == 0) %}
									<tr>
										<td colspan="7">No Data</td>
									</tr>
									{% else %}
									{% set count = 0 %}
										{% for order in orders %}
										<tr>
			    							<td class="font-weight-bold">{{totalNum - count - (currentPage*10)}} </td>
				  							{% set totalNum = totalNum - 1 %}
											<td>{{order.MID}}</td>
											<td>
											    <script>
    											Timefunction("{{order.CA}}");
    											</script>
											</td>
											<td>{{order.GN}}</td>
											<td>{{order.AM}}</td>
											<td class="with-btn" nowrap>
											    <button class="btn btn-sm btn-primary width-60 m-r-2 edit-btn" onclick ="receiptPay('{{order.IID}}')"  >영수증</button>
												<!--<button class="btn btn-sm btn-white width-60" onclick ="cancelPay()" value = "{{order.AN}}" id ="cancelpaybutton">환불</button>-->
											</td>
										</tr>
										{% endfor %}
									{% endif %}
								</tbody>
							</table>
							<div class="d-flex justify-content-between align-item-center">
								<input class="btn btn-primary" type='button' value='선택항목 삭제' onclick="return delete_check(this.form);">
								
								<div class="d-flex justify-content-around align-item-center">
									<a href="javascript:pageDoubleBtn('left')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-double-left"></i></a>
									<a href="javascript:pageBtn('left')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-left"></i></a>
									{% if (totalNum==0) %}
									{% else %}
										{% for i in range(startPage, endPage) %}
										<a href="/pay_list/?page={{i}}" class="btn btn-white mr-1 px-2 text-primary" style="{% if(currentPage==i} %} background-color: #00acac; color: white !important; {% endif %} ">{{i+1}}</a>
										{% endfor %}
									{% endif %}
									<a href="javascript:pageBtn('right')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-right"></i></a>
									<a href="javascript:pageDoubleBtn('right')" class="btn btn-primary mr-1 px-2"><i class="fas fa-angle-double-right"></i></a>
								</div>
							</div>
						<!--</form>-->
					</div>
				</div>
				<!-- end panel-body -->
			</div>
		</div>
		<!-- end col-10 -->
	</div>
	<!-- end row -->
</div>
<!-- end #content -->

<!-- Script -->
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    
    
    
    <script>
    // 환불 요청
    
    function cancelPay() {
      jQuery.ajax({
        "url": "{{IP}}payments/cancel",
        "type": "POST",
        "contentType": "application/json",
        "data": JSON.stringify({
          "merchant_uid": "merchant_1615354954382", // 주문번호
          "cancel_request_amount": 2000, // 환불금액
          "reason": "테스트 결제 환불", // 환불사유
          "refund_holder": "홍길동", // [가상계좌 환불시 필수입력] 환불 수령계좌 예금주
          "refund_bank": "88", // [가상계좌 환불시 필수입력] 환불 수령계좌 은행코드(ex. KG이니시스의 경우 신한은행은 88번)
          "refund_account": "56211105948400" // [가상계좌 환불시 필수입력] 환불 수령계좌 번호
        }),
        "dataType": "json"
      });
    }
    
    </script>
  
    <script>
	// 검색기능
	$(document).ready(function() {
        $("#keyword").keyup(function() {
            var k = $(this).val();
            $("#data-table-combine > tbody > tr").hide();
            var temp = $("#data-table-combine > tbody > tr > td:contains('" + k + "')");

            $(temp).parent().show();
        })
    })

    function searchbutton() {
		const keyword = document.getElementById('MIDkeyword').value;
		location = '/pay_list/?MID=' + keyword;
	}
	
	// 페이지 기능
	function pageBtn(dir) {
		if(dir == 'left') {
			location = '/pay_list/?page={{currentPage-1}}';
		}
		if(dir == 'right') {
			location = '/pay_list/?page={{currentPage+1}}';
		}
	}
	
	function pageDoubleBtn(dir) {
		if(dir == 'left') {
			location = '/pay_list/?page={{startPage-1}}';
		}
		if(dir == 'right') {
			location = '/pay_list/?page={{endPage+1}}';
		}
	}
	
    
    // 에러 링크 기능
	window.onload = () => {
		if (new URL(location.href).searchParams.get('error')) {
			alert('이미 존재하는 MAC 입니다.');
		}
		if (new URL(location.href).searchParams.get('null')) {
			alert('항목을 선택해주세요.');
		}
		if (new URL(location.href).searchParams.get('searcherror')) {
			alert('검색어를 다시 확인해주세요');
		}
	};
</script>
{% endblock %}


{% block script %}

<script src="../assets/plugins/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="../assets/plugins/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-colreorder/js/dataTables.colReorder.min.js"></script>
<script src="../assets/plugins/datatables.net-colreorder-bs4/js/colReorder.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="../assets/plugins/datatables.net-keytable-bs4/js/keyTable.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-rowreorder-bs4/js/rowReorder.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.colVis.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="../assets/plugins/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="../assets/plugins/pdfmake/build/pdfmake.min.js"></script>
<script src="../assets/plugins/pdfmake/build/vfs_fonts.js"></script>
<script src="../assets/plugins/jszip/dist/jszip.min.js"></script>
<!--<script src="../assets/js/demo/table-manage-combine.demo.js"></script>-->
{% endblock %}